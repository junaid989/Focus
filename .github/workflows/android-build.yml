name: Focus

on:
  workflow_dispatch: # run manually via button

jobs:
  build:
    name: Build Android Project
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Checkout Repository
        uses: actions/checkout@v4

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: 17

      - name: âš¡ Check and Setup Gradle Wrapper
        run: |
          echo "ğŸ” Checking Gradle wrapper files..."

          if [ ! -f "./gradlew" ]; then
            echo "âš ï¸ gradlew not found! Creating Gradle wrapper..."
            gradle wrapper
          fi

          if [ ! -f "./gradle/wrapper/gradle-wrapper.jar" ]; then
            echo "âš ï¸ gradle-wrapper.jar missing! Downloading latest verified version..."
            mkdir -p gradle/wrapper

            # Download directly from Gradle's Maven repo
            curl -sSL -o gradle/wrapper/gradle-wrapper.jar \
              https://repo.gradle.org/gradle/libs-releases-local/org/gradle/gradle-wrapper/8.10/gradle-wrapper-8.10.jar

            if [ ! -f "./gradle/wrapper/gradle-wrapper.jar" ]; then
              echo "âŒ Failed to download gradle-wrapper.jar!"
              exit 1
            fi
            echo "âœ… gradle-wrapper.jar downloaded successfully."
          else
            echo "âœ… Gradle wrapper already present."
          fi

          chmod +x gradlew

      - name: ğŸ—ï¸ Build with Gradle
        run: ./gradlew assembleDebug --stacktrace

      - name: ğŸ§ª Run Unit Tests
        run: ./gradlew testDebugUnitTest --stacktrace

      - name: ğŸ“¦ Upload APK (Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: focus-debug-apk
          path: app/build/outputs/apk/debug/*.apk
