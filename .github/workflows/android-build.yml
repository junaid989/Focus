name: Focus

on:
  workflow_dispatch: # manually run via "Run workflow" button

jobs:
  build:
    name: Build Android Project
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Checkout Repository
        uses: actions/checkout@v4

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: 17

      - name: âš¡ Check and Setup Gradle Wrapper
        run: |
          echo "ğŸ” Checking Gradle wrapper files..."
          if [ ! -f "./gradlew" ]; then
            echo "âš ï¸ gradlew not found! Creating Gradle wrapper..."
            gradle wrapper
          fi

          if [ ! -f "./gradle/wrapper/gradle-wrapper.jar" ]; then
            echo "âš ï¸ gradle-wrapper.jar missing! Downloading automatically..."
            mkdir -p gradle/wrapper
            curl -sSL https://services.gradle.org/distributions/gradle-8.10-bin.zip -o gradle-8.10-bin.zip
            unzip -q gradle-8.10-bin.zip -d gradle-temp
            JAR_PATH=$(find gradle-temp -name "gradle-wrapper.jar" | head -n 1)
            if [ -z "$JAR_PATH" ]; then
              echo "âŒ gradle-wrapper.jar not found inside Gradle zip!"
              exit 1
            fi
            cp "$JAR_PATH" gradle/wrapper/gradle-wrapper.jar
            rm -rf gradle-temp gradle-8.10-bin.zip
            echo "âœ… gradle-wrapper.jar downloaded successfully."
          else
            echo "âœ… Gradle wrapper already present."
          fi

          chmod +x gradlew

      - name: ğŸ—ï¸ Build with Gradle
        run: ./gradlew assembleDebug --stacktrace

      - name: ğŸ§ª Run Unit Tests
        run: ./gradlew testDebugUnitTest --stacktrace

      - name: ğŸ“¦ Upload APK (Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: focus-debug-apk
          path: app/build/outputs/apk/debug/*.apk
